import socket  # Lib pra manipular sockets

# Cria um socket TCP
"""
AF_INET -> Indica que estamos usando Ipv4
SOCK_STREAM -> Indica que o socket é TCP
"""
server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# Abre um arquivo pra escrever os dados recebidos
file = open("output.txt", "w")

try:
    server.bind(("0.0.0.0", 4433))  # Associa o socket a todos IP's locais e a porta 4433
    server.listen(5)  # Bota o server no Listening, com backlog de 5 conexões no MAX
    print("Servidor escutando...")

    # Aceita uma nova conexão e cria um novo socket pra comunicar com o client
    # Printa o IP do client conectado
    client_socket, address = server.accept()
    print("Recebido de: " + address[0])

    # Recebe dados do cliente (até 1024 bytes) e decodifica pra string
    data = client_socket.recv(1024).decode()
    file.write(data)  # Escreve os dados recebidos no arquivo

    server.close()  # Fecha o servidor

except Exception as error:
    print("Erro: ", error)  # Printa o erro, caso houver
