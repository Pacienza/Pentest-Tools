import sys  # Usado para manipular argumentos passados na linha de comando
import dns.resolver  # módulo que faz consultas de DNS

# Cria uma instância do resolvedor DNS pra fazer as consultas
resolver = dns.resolver.Resolver()

"""
Tenta capturar o domínio alvo e o arquivo de wordlist dos argumentos da linha de comando.
Se falhar, imprime a forma correta de uso e encerra o script.
"""
try:
    alvo = sys.argv[1]  # O Dominio alvo passado como argumento
    wordlist = sys.argv[2]  # O arquivo da wordlist como argumento tbm
except:
    # ao jeito certo de funcionar o script no terminal:
    print("Comando correto: python3 dnsbrute.py dominio wordlist.txt")
    sys.exit()

"""
Tenta abrir e ler o arquivo de wordlist, criando uma lista de subdomínios.

"""

try:
    with open(wordlist, "r") as arq:
        subdominios = arq.read().splitlines()  # Lê o arquivo e cria uma lista de subdomínios
except:
    # printa o erro se não encontrar arquivo
    print("Erro ao abrir arquivo")
    sys.exit()

#  Para cada subdominio na lista de subdominios:
for subdominio in subdominios:
    try:
        # formata o subdominio completo
        sub_alvo = "{}.{}".format(subdominio, alvo)

        # Resolve o subdominio completo pra obter registros A
        resultados = resolver.resolve(sub_alvo, "A")

        # Para cada resultado, printa subdominio completo e IP associado
        for resultado in resultados:
            print("{} -> {}".format(sub_alvo, resultado))
    except:
        # Se ocorrer qualquer erro (como não encontrar o subdomínio), passa para o próximo
        pass
